<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Oyna - Gekkotari</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        canvas {
            display: block;
            margin: 0 auto;
            border: 2px solid #50F589;
            box-shadow: 0 0 20px rgba(80, 245, 137, 0.2);
            background-color: #000;
        }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <a class="navbar-brand" href="kutuphane.html"><i class="fas fa-arrow-left"></i> Kütüphaneye Dön</a>
        </div>
    </header>

    <main class="container my-4 text-center">
        <h2 class="text-warning mb-3">Yılan Oyunu (Snake)</h2>
        <div class="d-flex justify-content-center gap-4 mb-3">
            <h4 class="text-white">Puan: <span id="skor" class="text-success">0</span></h4>
            <h4 class="text-white">En Yüksek: <span id="enYuksek" class="text-warning">0</span></h4>
        </div>
        
        <canvas id="oyunTahtasi" width="400" height="400"></canvas>

        <div class="mt-3 text-muted">
            <p><i class="fas fa-keyboard"></i> <b>WASD</b> veya <b>Yön Tuşları</b> ile oyna!</p>
            <button onclick="oyunuBaslat()" class="btn btn-primary-custom">
                <i class="fas fa-redo"></i> Yeniden Başlat
            </button>
        </div>
    </main>

    <script>
        const canvas = document.getElementById("oyunTahtasi");
        const ctx = canvas.getContext("2d");

        let hiz = 7; 
        let tileCount = 20; 
        let tileSize = canvas.width / tileCount - 2; 
        
        let headX = 10;
        let headY = 10;
        let xHiz = 0;
        let yHiz = 0;

        let elmaX = 5;
        let elmaY = 5;

        let yilanParcalari = [];
        let kuyrukUzunlugu = 2;

        let skor = 0;
        let oyunBittiMi = false;
        let yonDegisti = false;

        window.onload = function() {
            oyunuCiz();
            document.addEventListener("keydown", tusBasildi);
        };

        function oyunuCiz() {
            if(oyunBittiMi) return;

            konumDegistir();
            yonDegisti = false; 
            
            if(oyunBittiKontrol()) {
                ctx.fillStyle = "white";
                ctx.font = "30px Verdana";
                ctx.fillText("Oyun Bitti!", canvas.width / 6.5, canvas.height / 2);
                return;
            }

            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            elmaKontrol();

            ctx.fillStyle = "#50F589"; 
            for(let i = 0; i < yilanParcalari.length; i++){
                let parca = yilanParcalari[i];
                ctx.fillRect(parca.x * tileCount, parca.y * tileCount, tileSize, tileSize);
            }

            yilanParcalari.push(new YilanParcasi(headX, headY));
            while (yilanParcalari.length > kuyrukUzunlugu) {
                yilanParcalari.shift(); 
            }

            ctx.fillStyle = "red";
            ctx.fillRect(elmaX * tileCount, elmaY * tileCount, tileSize, tileSize);

            document.getElementById("skor").innerText = skor;

            setTimeout(oyunuCiz, 1000 / hiz);
        }

        function konumDegistir() {
            headX = headX + xHiz;
            headY = headY + yHiz;
        }

        function elmaKontrol() {
            if (elmaX === headX && elmaY === headY) {
                elmaX = Math.floor(Math.random() * tileCount);
                elmaY = Math.floor(Math.random() * tileCount);
                kuyrukUzunlugu++;
                skor += 10;
                if(skor % 50 === 0) hiz++;
            }
        }

        function oyunBittiKontrol() {
            let bitti = false;

            if (xHiz === 0 && yHiz === 0) return false;

            if (headX < 0 || headX === tileCount || headY < 0 || headY === tileCount) {
                bitti = true;
            }

            for (let i = 0; i < yilanParcalari.length; i++) {
                let parca = yilanParcalari[i];
                if (parca.x === headX && parca.y === headY) {
                    bitti = true;
                    break;
                }
            }

            if (bitti) {
                oyunBittiMi = true;
                let enYuksek = localStorage.getItem("snakeEnYuksek") || 0;
                if (skor > enYuksek) {
                    localStorage.setItem("snakeEnYuksek", skor);
                }
                document.getElementById("enYuksek").innerText = localStorage.getItem("snakeEnYuksek");
            }
            return bitti;
        }

        function tusBasildi(event) {
            // Tuş kodları:
            // Oklar: Sol(37), Yukarı(38), Sağ(39), Aşağı(40)
            // WASD:  A(65), W(87), D(68), S(83)

            // Sayfa kaymasını engelle
            if([37, 38, 39, 40, 65, 87, 68, 83].indexOf(event.keyCode) > -1) {
                event.preventDefault();
            }

            if(yonDegisti) return;

            // Yukarı (Ok Yukarı veya W)
            if (event.keyCode == 38 || event.keyCode == 87) {
                if (yHiz == 1) return; 
                yHiz = -1;
                xHiz = 0;
                yonDegisti = true;
            }
            // Aşağı (Ok Aşağı veya S)
            if (event.keyCode == 40 || event.keyCode == 83) {
                if (yHiz == -1) return;
                yHiz = 1;
                xHiz = 0;
                yonDegisti = true;
            }
            // Sol (Ok Sol veya A)
            if (event.keyCode == 37 || event.keyCode == 65) {
                if (xHiz == 1) return;
                yHiz = 0;
                xHiz = -1;
                yonDegisti = true;
            }
            // Sağ (Ok Sağ veya D)
            if (event.keyCode == 39 || event.keyCode == 68) {
                if (xHiz == -1) return;
                yHiz = 0;
                xHiz = 1;
                yonDegisti = true;
            }
        }

        function oyunuBaslat() {
            location.reload(); 
        }

        class YilanParcasi {
            constructor(x, y) {
                this.x = x;
                this.y = y;
            }
        }
        
        document.getElementById("enYuksek").innerText = localStorage.getItem("snakeEnYuksek") || 0;

    </script>
</body>
</html>