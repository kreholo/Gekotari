<script type="module">
  // 1. Firebase Kütüphanelerini İnternetten Çekiyoruz (Tarayıcı için)
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // 2. SENİN PROJE AYARLARIN (Attığın kodları buraya işledim)
  const firebaseConfig = {
    apiKey: "AIzaSyDGprox9gi-aYNI6jeh0sj52C9M5zxEtzc",
    authDomain: "gekkotari.firebaseapp.com",
    projectId: "gekkotari",
    storageBucket: "gekkotari.firebasestorage.app",
    messagingSenderId: "313683103714",
    appId: "1:313683103714:web:050b8947af000d26a833bb",
    measurementId: "G-8K9Y0SQQ5C"
  };

  // 3. Veritabanını Başlatıyoruz
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // --- OYUN KAYDETME (Firebase'e Gönderir) ---
  window.oyunKaydet = async function() {
      const ad = document.getElementById("yeniAd").value;
      const tur = document.getElementById("yeniKategori").value;
      const resim = document.getElementById("yeniResim").value;
      const etiket = document.getElementById("yeniEtiket").value;
      const link = document.getElementById("yeniLink").value || "yerel";

      if(!ad) return alert("Lütfen oyun adını yaz!");

      try {
          // 'oyunlar' adlı koleksiyona (tabloya) ekle
          await addDoc(collection(db, "oyunlar"), {
              ad: ad, tur: tur, resim: resim, etiket: etiket, link: link
          });
          alert("BAŞARILI! Oyun Google veritabanına kaydedildi.");
          
          // Pencereyi kapat ve listeyi yenile
          bootstrap.Modal.getInstance(document.getElementById('oyunEkleModal')).hide();
          listeyiYenile(); 
      } catch (hata) {
          console.error("Hata detayı:", hata);
          alert("Bir hata oluştu: " + hata.message);
      }
  }

  // --- OYUNLARI LİSTELEME (Google'dan Çeker) ---
  window.listeyiYenile = async function() {
      const tablo = document.getElementById("adminOyunListesi");
      tablo.innerHTML = "<tr><td colspan='5' class='text-center'>Veriler Google'dan yükleniyor...</td></tr>";

      try {
          const veriler = await getDocs(collection(db, "oyunlar"));
          tablo.innerHTML = ""; // Temizle
          
          veriler.forEach((belge) => {
              const oyun = belge.data();
              const id = belge.id; // Silmek için lazım olan kimlik
              
              let linkDurumu = oyun.link === "yerel" ? "<span class='badge bg-info'>Yerel</span>" : "<span class='badge bg-warning text-dark'>Web</span>";

              tablo.innerHTML += `
                  <tr>
                      <td><img src="https://via.placeholder.com/40x40/2c3e50/50F589?text=${oyun.resim}" class="rounded"></td>
                      <td>${oyun.ad}</td>
                      <td><span class="badge bg-secondary">${oyun.tur}</span></td>
                      <td>${linkDurumu}</td>
                      <td class="text-end">
                          <button onclick="oyunSil('${id}')" class="btn btn-sm btn-outline-danger"><i class="fas fa-trash"></i> Sil</button>
                      </td>
                  </tr>`;
          });
      } catch (hata) {
          tablo.innerHTML = `<tr><td colspan='5' class='text-danger'>Veri çekilemedi: ${hata.message}</td></tr>`;
      }
  }

  // --- OYUN SİLME ---
  window.oyunSil = async function(id) {
      if(confirm("Bu oyunu kalıcı olarak silmek istiyor musun?")) {
          await deleteDoc(doc(db, "oyunlar", id));
          listeyiYenile();
      }
  }

  // Sayfa açıldığında
  document.addEventListener('DOMContentLoaded', function() {
      // Giriş kontrolü (Admin mi?)
      var aktif = JSON.parse(localStorage.getItem("aktifOturum"));
      if (!aktif || aktif.email !== "admin@gekkotari.com") {
           window.location.href = "index.html";
           return;
      }
      listeyiYenile();
  });
</script>